"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.getNeededRegistryParameters = void 0;
const pieces_1 = require("@sapphire/pieces");
async function getNeededRegistryParameters() {
    const { client } = pieces_1.container;
    const applicationCommands = client.application.commands;
    const globalCommands = await applicationCommands.fetch({ withLocalizations: true });
    const guildCommands = await fetchGuildCommands(applicationCommands);
    return {
        applicationCommands,
        globalCommands,
        guildCommands
    };
}
exports.getNeededRegistryParameters = getNeededRegistryParameters;
async function fetchGuildCommands(commands) {
    const map = new Map();
    for (const [guildId, guild] of commands.client.guilds.cache.entries()) {
        try {
            const guildCommands = await commands.fetch({ guildId, withLocalizations: true });
            map.set(guildId, guildCommands);
        }
        catch (err) {
            if (!pieces_1.container.client.options.preventFailedToFetchLogForGuildIds?.includes(guildId)) {
                pieces_1.container.logger.warn(`ApplicationCommandRegistries: Failed to fetch guild commands for guild "${guild.name}" (${guildId}).`, 'Make sure to authorize your application with the "applications.commands" scope in that guild.');
            }
        }
    }
    return map;
}
//# sourceMappingURL=getNeededParameters.js.map